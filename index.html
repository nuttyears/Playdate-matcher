<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playdate Matcher</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // CONFIGURATION - Replace these with your actual values from Supabase and Twilio
        const SUPABASE_URL = 'https://yoxkgzxcqkliwxevgarm.supabase.co'; // e.g., https://xxxxx.supabase.co
        const SUPABASE_ANON_KEY = 'sb_publishable_TcL1LMmxu5hKNVsHkPMi_A_lT0xVAov'; // Your anon/public key from Supabase

        // Simple Supabase client
        class SupabaseClient {
          constructor(url, key) {
            this.url = url;
            this.key = key;
            this.headers = {
              'apikey': key,
              'Authorization': `Bearer ${key}`,
              'Content-Type': 'application/json'
            };
          }

          async query(table, options = {}) {
            const { select = '*', filter, insert, update, delete: deleteId } = options;
            
            let url = `${this.url}/rest/v1/${table}`;
            let method = 'GET';
            let body = null;

            if (insert) {
              method = 'POST';
              body = JSON.stringify(insert);
              url += '?select=*';
            } else if (update) {
              method = 'PATCH';
              body = JSON.stringify(update);
              url += `?${filter}&select=*`;
            } else if (deleteId) {
              method = 'DELETE';
              url += `?id=eq.${deleteId}`;
            } else if (filter) {
              url += `?${filter}&select=${select}`;
            } else {
              url += `?select=${select}`;
            }

            const response = await fetch(url, {
              method,
              headers: this.headers,
              body
            });

            if (!response.ok) {
              throw new Error(`Supabase error: ${response.statusText}`);
            }

            return method === 'DELETE' ? null : await response.json();
          }

          async callFunction(functionName, params) {
            const response = await fetch(`${this.url}/functions/v1/${functionName}`, {
              method: 'POST',
              headers: this.headers,
              body: JSON.stringify(params)
            });
            
            if (!response.ok) {
              throw new Error(`Function call error: ${response.statusText}`);
            }
            
            return await response.json();
          }
        }

        const supabase = new SupabaseClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Lucide Icons as inline SVG components
        const Calendar = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Users = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const MapPin = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Plus = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Check = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const User = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const Phone = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </svg>
        );

        const Home = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        const Edit2 = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Trash2 = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Bell = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
        );

        const PlaydateMatcher = () => {
          const [currentView, setCurrentView] = useState('dashboard');
          const [profile, setProfile] = useState(null);
          const [playdates, setPlaydates] = useState([]);
          const [editingPlaydate, setEditingPlaydate] = useState(null);
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState(null);

          const isSupabaseConfigured = SUPABASE_URL !== 'YOUR_SUPABASE_URL' && SUPABASE_ANON_KEY !== 'YOUR_SUPABASE_ANON_KEY';

          useEffect(() => {
            loadData();
          }, []);

          const loadData = async () => {
            try {
              setLoading(true);
              
              if (isSupabaseConfigured) {
                const profileId = localStorage.getItem('profileId');
                
                if (profileId) {
                  const [profileData, playdatesData] = await Promise.all([
                    supabase.query('profiles', { filter: `id=eq.${profileId}` }),
                    supabase.query('playdates', { filter: `creator_id=eq.${profileId}` })
                  ]);
                  
                  if (profileData && profileData.length > 0) {
                    setProfile(profileData[0]);
                  }
                  
                  setPlaydates(playdatesData || []);
                }
              } else {
                const savedProfile = localStorage.getItem('playdateProfile');
                const savedPlaydates = localStorage.getItem('playdates');
                
                if (savedProfile) setProfile(JSON.parse(savedProfile));
                if (savedPlaydates) setPlaydates(JSON.parse(savedPlaydates));
              }
            } catch (err) {
              setError(err.message);
              console.error('Load error:', err);
            } finally {
              setLoading(false);
            }
          };

          const saveProfile = async (newProfile) => {
            try {
              if (isSupabaseConfigured) {
                const result = await supabase.query('profiles', {
                  insert: newProfile
                });
                
                if (result && result.length > 0) {
                  const savedProfile = result[0];
                  setProfile(savedProfile);
                  localStorage.setItem('profileId', savedProfile.id);
                }
              } else {
                setProfile(newProfile);
                localStorage.setItem('playdateProfile', JSON.stringify(newProfile));
              }
              
              setCurrentView('dashboard');
            } catch (err) {
              setError(err.message);
              console.error('Save profile error:', err);
            }
          };

          const savePlaydate = async (playdateData) => {
            try {
              if (isSupabaseConfigured && profile) {
                const dataToSave = {
                  ...playdateData,
                  creator_id: profile.id,
                  status: editingPlaydate ? playdateData.status : 'planning'
                };

                if (editingPlaydate) {
                  const result = await supabase.query('playdates', {
                    update: dataToSave,
                    filter: `id=eq.${editingPlaydate.id}`
                  });
                  
                  setPlaydates(playdates.map(p => p.id === editingPlaydate.id ? result[0] : p));
                } else {
                  const result = await supabase.query('playdates', {
                    insert: dataToSave
                  });
                  
                  if (result && result.length > 0) {
                    setPlaydates([...playdates, result[0]]);
                  }
                }
              } else {
                if (editingPlaydate) {
                  const updated = playdates.map(p => p.id === editingPlaydate.id ? playdateData : p);
                  setPlaydates(updated);
                  localStorage.setItem('playdates', JSON.stringify(updated));
                } else {
                  const newPlaydates = [...playdates, { ...playdateData, id: Date.now(), status: 'planning' }];
                  setPlaydates(newPlaydates);
                  localStorage.setItem('playdates', JSON.stringify(newPlaydates));
                }
              }
              
              setEditingPlaydate(null);
              setCurrentView('dashboard');
            } catch (err) {
              setError(err.message);
              console.error('Save playdate error:', err);
            }
          };

          const deletePlaydate = async (id) => {
            try {
              if (isSupabaseConfigured) {
                await supabase.query('playdates', { delete: id });
              }
              
              const updated = playdates.filter(p => p.id !== id);
              setPlaydates(updated);
              
              if (!isSupabaseConfigured) {
                localStorage.setItem('playdates', JSON.stringify(updated));
              }
            } catch (err) {
              setError(err.message);
              console.error('Delete error:', err);
            }
          };

          const updateStatus = async (id, status) => {
            try {
              const playdate = playdates.find(p => p.id === id);
              
              if (isSupabaseConfigured) {
                const result = await supabase.query('playdates', {
                  update: { status },
                  filter: `id=eq.${id}`
                });
                
                setPlaydates(playdates.map(p => p.id === id ? result[0] : p));
                
                if (status === 'confirmed' && profile) {
                  await sendConfirmationSMS(playdate, profile);
                }
              } else {
                const updated = playdates.map(p => p.id === id ? { ...p, status } : p);
                setPlaydates(updated);
                localStorage.setItem('playdates', JSON.stringify(updated));
              }
            } catch (err) {
              setError(err.message);
              console.error('Update status error:', err);
            }
          };

          const sendConfirmationSMS = async (playdate, profile) => {
            try {
              await supabase.callFunction('send_sms_notification', {
                playdate_id: playdate.id,
                phone_number: profile.parent_phone || profile.parentPhone,
                message_type: 'confirmation'
              });
            } catch (err) {
              console.error('SMS error:', err);
            }
          };

          if (loading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 flex items-center justify-center">
                <div className="text-center">
                  <Users className="w-16 h-16 text-purple-600 mx-auto mb-4 animate-pulse" />
                  <p className="text-gray-600">Loading...</p>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
              {!isSupabaseConfigured && (
                <div className="bg-yellow-50 border-b border-yellow-200 px-4 py-3">
                  <div className="max-w-4xl mx-auto flex items-center gap-2 text-sm text-yellow-800">
                    <Bell className="w-4 h-4" />
                    <span>Using local storage. Set up Supabase + Twilio for SMS notifications and reminders.</span>
                  </div>
                </div>
              )}

              {error && (
                <div className="bg-red-50 border-b border-red-200 px-4 py-3">
                  <div className="max-w-4xl mx-auto flex items-center gap-2 text-sm text-red-800">
                    <span>Error: {error}</span>
                    <button onClick={() => setError(null)} className="ml-auto text-red-600 hover:text-red-800">Ã—</button>
                  </div>
                </div>
              )}

              <header className="bg-white shadow-sm">
                <div className="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <Users className="w-8 h-8 text-purple-600" />
                    <h1 className="text-2xl font-bold text-gray-800">Playdate Matcher</h1>
                  </div>
                  {profile && (
                    <button
                      onClick={() => setCurrentView('profile')}
                      className="flex items-center gap-2 px-4 py-2 text-purple-600 hover:bg-purple-50 rounded-lg transition"
                    >
                      <User className="w-5 h-5" />
                      <span>{profile.kid_name || profile.kidName}</span>
                    </button>
                  )}
                </div>
              </header>

              <main className="max-w-4xl mx-auto px-4 py-8">
                {!profile && <OnboardingView onComplete={saveProfile} isSupabaseConfigured={isSupabaseConfigured} />}
                {profile && currentView === 'dashboard' && (
                  <DashboardView 
                    playdates={playdates}
                    onNewPlaydate={() => {
                      setEditingPlaydate(null);
                      setCurrentView('create');
                    }}
                    onEdit={(playdate) => {
                      setEditingPlaydate(playdate);
                      setCurrentView('create');
                    }}
                    onDelete={deletePlaydate}
                    onUpdateStatus={updateStatus}
                    isSupabaseConfigured={isSupabaseConfigured}
                  />
                )}
                {profile && currentView === 'create' && (
                  <CreatePlaydateView
                    profile={profile}
                    playdate={editingPlaydate}
                    onSave={savePlaydate}
                    onCancel={() => {
                      setEditingPlaydate(null);
                      setCurrentView('dashboard');
                    }}
                  />
                )}
                {profile && currentView === 'profile' && (
                  <ProfileView 
                    profile={profile}
                    onUpdate={saveProfile}
                    onBack={() => setCurrentView('dashboard')}
                  />
                )}
              </main>
            </div>
          );
        };

        const OnboardingView = ({ onComplete, isSupabaseConfigured }) => {
          const [formData, setFormData] = useState({
            kid_name: '',
            zip_code: '',
            parent_phone: ''
          });

          const handleSubmit = (e) => {
            e.preventDefault();
            if (formData.kid_name && formData.zip_code && formData.parent_phone) {
              onComplete(formData);
            }
          };

          return (
            <div className="max-w-md mx-auto">
              <div className="bg-white rounded-2xl shadow-lg p-8">
                <div className="text-center mb-8">
                  <div className="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <Users className="w-8 h-8 text-purple-600" />
                  </div>
                  <h2 className="text-2xl font-bold text-gray-800 mb-2">Welcome to Playdate Matcher!</h2>
                  <p className="text-gray-600">Let's set up your profile to get started</p>
                  {isSupabaseConfigured && (
                    <p className="text-sm text-green-600 mt-2">ðŸ“± You'll receive SMS confirmations and reminders</p>
                  )}
                </div>

                <form onSubmit={handleSubmit} className="space-y-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Child's Name
                    </label>
                    <input
                      type="text"
                      required
                      value={formData.kid_name}
                      onChange={(e) => setFormData({ ...formData, kid_name: e.target.value })}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      placeholder="Emma"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Zip Code
                    </label>
                    <input
                      type="text"
                      required
                      pattern="[0-9]{5}"
                      value={formData.zip_code}
                      onChange={(e) => setFormData({ ...formData, zip_code: e.target.value })}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      placeholder="94102"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Your Phone Number
                    </label>
                    <input
                      type="tel"
                      required
                      value={formData.parent_phone}
                      onChange={(e) => setFormData({ ...formData, parent_phone: e.target.value })}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      placeholder="(555) 123-4567"
                    />
                    {isSupabaseConfigured && (
                      <p className="text-xs text-gray-500 mt-1">
                        ðŸ“± We'll text you playdate confirmations and reminders
                      </p>
                    )}
                  </div>

                  <button
                    type="submit"
                    className="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition"
                  >
                    Get Started
                  </button>
                </form>
              </div>
            </div>
          );
        };

        const DashboardView = ({ playdates, onNewPlaydate, onEdit, onDelete, onUpdateStatus, isSupabaseConfigured }) => {
          const upcomingPlaydates = playdates.filter(p => p.status !== 'completed');
          const completedPlaydates = playdates.filter(p => p.status === 'completed');

          return (
            <div className="space-y-6">
              <div className="flex items-center justify-between">
                <h2 className="text-2xl font-bold text-gray-800">Your Playdates</h2>
                <button
                  onClick={onNewPlaydate}
                  className="flex items-center gap-2 bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition shadow-md"
                >
                  <Plus className="w-5 h-5" />
                  New Playdate
                </button>
              </div>

              {isSupabaseConfigured && (
                <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                  <div className="flex items-start gap-3">
                    <Check className="w-5 h-5 text-green-600 mt-0.5" />
                    <div className="flex-1">
                      <h3 className="font-semibold text-green-900 mb-1">ðŸ“± SMS Notifications Active</h3>
                      <p className="text-sm text-green-700">
                        Confirmations and reminders will be sent automatically via text message
                      </p>
                    </div>
                  </div>
                </div>
              )}

              {upcomingPlaydates.length === 0 && completedPlaydates.length === 0 && (
                <div className="bg-white rounded-2xl shadow-md p-12 text-center">
                  <Users className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                  <h3 className="text-xl font-semibold text-gray-600 mb-2">No playdates yet</h3>
                  <p className="text-gray-500 mb-6">Create your first playdate to get started!</p>
                  <button
                    onClick={onNewPlaydate}
                    className="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition"
                  >
                    Create Playdate
                  </button>
                </div>
              )}

              {upcomingPlaydates.length > 0 && (
                <div>
                  <h3 className="text-lg font-semibold text-gray-700 mb-4">Upcoming & Planning</h3>
                  <div className="space-y-4">
                    {upcomingPlaydates.map(playdate => (
                      <PlaydateCard
                        key={playdate.id}
                        playdate={playdate}
                        onEdit={() => onEdit(playdate)}
                        onDelete={() => onDelete(playdate.id)}
                        onUpdateStatus={(status) => onUpdateStatus(playdate.id, status)}
                        isSupabaseConfigured={isSupabaseConfigured}
                      />
                    ))}
                  </div>
                </div>
              )}

              {completedPlaydates.length > 0 && (
                <div>
                  <h3 className="text-lg font-semibold text-gray-700 mb-4">Completed</h3>
                  <div className="space-y-4">
                    {completedPlaydates.map(playdate => (
                      <PlaydateCard
                        key={playdate.id}
                        playdate={playdate}
                        onEdit={() => onEdit(playdate)}
                        onDelete={() => onDelete(playdate.id)}
                        onUpdateStatus={(status) => onUpdateStatus(playdate.id, status)}
                        isSupabaseConfigured={isSupabaseConfigured}
                      />
                    ))}
                  </div>
                </div>
              )}
            </div>
          );
        };

        const PlaydateCard = ({ playdate, onEdit, onDelete, onUpdateStatus, isSupabaseConfigured }) => {
          const statusColors = {
            planning: 'bg-yellow-100 text-yellow-800',
            confirmed: 'bg-green-100 text-green-800',
            completed: 'bg-gray-100 text-gray-600'
          };

          const statusLabels = {
            planning: 'Planning',
            confirmed: 'Confirmed',
            completed: 'Completed'
          };

          return (
            <div className="bg-white rounded-xl shadow-md p-6 hover:shadow-lg transition">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <h3 className="text-xl font-bold text-gray-800">{playdate.title || 'Playdate'}</h3>
                    <span className={`px-3 py-1 rounded-full text-xs font-semibold ${statusColors[playdate.status]}`}>
                      {statusLabels[playdate.status]}
                    </span>
                    {playdate.status === 'confirmed' && isSupabaseConfigured && (
                      <span className="flex items-center gap-1 text-xs text-green-600">
                        <Phone className="w-3 h-3" />
                        SMS sent
                      </span>
                    )}
                  </div>
                  
                  <div className="space-y-2 text-gray-600">
                    <div className="flex items-center gap-2">
                      <Calendar className="w-4 h-4" />
                      <span>{playdate.date} at {playdate.time}</span>
                    </div>
                    
                    <div className="flex items-center gap-2">
                      <Users className="w-4 h-4" />
                      <span>{playdate.type === 'oneOnOne' ? '1:1 Playdate' : 'Group Playdate'}</span>
                    </div>
                    
                    {playdate.location && (
                      <div className="flex items-center gap-2">
                        <MapPin className="w-4 h-4" />
                        <span>{playdate.location}</span>
                      </div>
                    )}
                  </div>

                  {playdate.activity && (
                    <div className="mt-3 p-3 bg-purple-50 rounded-lg">
                      <p className="text-sm text-gray-700"><strong>Activity:</strong> {playdate.activity}</p>
                    </div>
                  )}

                  {playdate.notes && (
                    <div className="mt-3 p-3 bg-blue-50 rounded-lg">
                      <p className="text-sm text-gray-700">{playdate.notes}</p>
                    </div>
                  )}
                </div>

                <div className="flex gap-2 ml-4">
                  <button
                    onClick={onEdit}
                    className="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition"
                  >
                    <Edit2 className="w-4 h-4" />
                  </button>
                  <button
                    onClick={onDelete}
                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>
              </div>

              {playdate.status !== 'completed' && (
                <div className="flex gap-2 pt-4 border-t">
                  {playdate.status === 'planning' && (
                    <button
                      onClick={() => onUpdateStatus('confirmed')}
                      className="flex-1 flex items-center justify-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 transition"
                    >
                      <Check className="w-4 h-4" />
                      {isSupabaseConfigured ? 'Confirm & Send SMS' : 'Confirm Playdate'}
                    </button>
                  )}
                  {playdate.status === 'confirmed' && (
                    <button
                      onClick={() => onUpdateStatus('completed')}
                      className="flex-1 flex items-center justify-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-700 transition"
                    >
                      <Check className="w-4 h-4" />
                      Mark Complete
                    </button>
                  )}
                </div>
              )}
            </div>
          );
        };

        const CreatePlaydateView = ({ profile, playdate, onSave, onCancel }) => {
          const [formData, setFormData] = useState(playdate || {
            title: '',
            date: '',
            time: '',
            type: 'oneOnOne',
            location: '',
            activity: '',
            notes: ''
          });

          const handleSubmit = (e) => {
            e.preventDefault();
            onSave(formData);
          };

          return (
            <div className="max-w-2xl mx-auto">
              <div className="bg-white rounded-2xl shadow-lg p-8">
                <h2 className="text-2xl font-bold text-gray-800 mb-6">
                  {playdate ? 'Edit Playdate' : 'Create New Playdate'}
                </h2>

                <form onSubmit={handleSubmit} className="space-y-6">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Playdate Title (Optional)
                    </label>
                    <input
                      type="text"
                      value={formData.title}
                      onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      placeholder="Park playdate, Swimming, etc."
                    />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Date *
                      </label>
                      <input
                        type="date"
                        required
                        value={formData.date}
                        onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Time *
                      </label>
                      <input
                        type="time"
                        required
                        value={formData.time}
                        onChange={(e) => setFormData({ ...formData, time: e.target.value })}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      />
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Playdate Type *
                    </label>
                    <div className="grid grid-cols-2 gap-4">
                      <button
                        type="button"
                        onClick={() => setFormData({ ...formData, type: 'oneOnOne' })}
                        className={`p-4 border-2 rounded-lg transition ${
                          formData.type === 'oneOnOne'
                            ? 'border-purple-600 bg-purple-50'
                            : 'border-gray-300 hover:border-gray-400'
                        }`}
                      >
                        <div className="font-semibold text-gray-800">1:1 Playdate</div>
                        <div className="text-sm text-gray-600 mt-1">Just one other family</div>
                      </button>

                      <button
                        type="button"
                        onClick={() => setFormData({ ...formData, type: 'group' })}
                        className={`p-4 border-2 rounded-lg transition ${
                          formData.type === 'group'
                            ? 'border-purple-600 bg-purple-50'
                            : 'border-gray-300 hover:border-gray-400'
                        }`}
                      >
                        <div className="font-semibold text-gray-800">Group Playdate</div>
                        <div className="text-sm text-gray-600 mt-1">Multiple families welcome</div>
                      </button>
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Location / Event Venue
                    </label>
                    <input
                      type="text"
                      value={formData.location}
                      onChange={(e) => setFormData({ ...formData, location: e.target.value })}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      placeholder="Central Park, My house, etc."
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Activity / Event Details
                    </label>
                    <input
                      type="text"
                      value={formData.activity}
                      onChange={(e) => setFormData({ ...formData, activity: e.target.value })}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      placeholder="Swimming, Arts & crafts, Birthday party, etc."
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Additional Notes
                    </label>
                    <textarea
                      value={formData.notes}
                      onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                      rows={3}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      placeholder="Any other details parents should know..."
                    />
                  </div>

                  <div className="flex gap-4 pt-4">
                    <button
                      type="button"
                      onClick={onCancel}
                      className="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition"
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      className="flex-1 bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition"
                    >
                      {playdate ? 'Update Playdate' : 'Create Playdate'}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          );
        };

        const ProfileView = ({ profile, onUpdate, onBack }) => {
          const [editing, setEditing] = useState(false);
          const [formData, setFormData] = useState(profile);

          const handleSubmit = (e) => {
            e.preventDefault();
            onUpdate(formData);
            setEditing(false);
          };

          return (
            <div className="max-w-2xl mx-auto">
              <div className="bg-white rounded-2xl shadow-lg p-8">
                <div className="flex items-center justify-between mb-6">
                  <h2 className="text-2xl font-bold text-gray-800">Your Profile</h2>
                  {!editing && (
                    <button
                      onClick={() => setEditing(true)}
                      className="flex items-center gap-2 text-purple-600 hover:bg-purple-50 px-4 py-2 rounded-lg transition"
                    >
                      <Edit2 className="w-4 h-4" />
                      Edit
                    </button>
                  )}
                </div>

                {!editing ? (
                  <div className="space-y-6">
                    <div className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg">
                      <User className="w-6 h-6 text-purple-600 mt-1" />
                      <div>
                        <div className="text-sm text-gray-600">Child's Name</div>
                        <div className="text-lg font-semibold text-gray-800">{profile.kid_name || profile.kidName}</div>
                      </div>
                    </div>

                    <div className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg">
                      <Home className="w-6 h-6 text-purple-600 mt-1" />
                      <div>
                        <div className="text-sm text-gray-600">Zip Code</div>
                        <div className="text-lg font-semibold text-gray-800">{profile.zip_code || profile.zipCode}</div>
                      </div>
                    </div>

                    <div className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg">
                      <Phone className="w-6 h-6 text-purple-600 mt-1" />
                      <div>
                        <div className="text-sm text-gray-600">Phone Number</div>
                        <div className="text-lg font-semibold text-gray-800">{profile.parent_phone || profile.parentPhone}</div>
                      </div>
                    </div>

                    <button
                      onClick={onBack}
                      className="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition"
                    >
                      Back to Dashboard
                    </button>
                  </div>
                ) : (
                  <form onSubmit={handleSubmit} className="space-y-6">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Child's Name
                      </label>
                      <input
                        type="text"
                        required
                        value={formData.kid_name || formData.kidName}
                        onChange={(e) => setFormData({ ...formData, kid_name: e.target.value })}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Zip Code
                      </label>
                      <input
                        type="text"
                        required
                        pattern="[0-9]{5}"
                        value={formData.zip_code || formData.zipCode}
                        onChange={(e) => setFormData({ ...formData, zip_code: e.target.value })}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        Your Phone Number
                      </label>
                      <input
                        type="tel"
                        required
                        value={formData.parent_phone || formData.parentPhone}
                        onChange={(e) => setFormData({ ...formData, parent_phone: e.target.value })}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      />
                    </div>

                    <div className="flex gap-4">
                      <button
                        type="button"
                        onClick={() => {
                          setFormData(profile);
                          setEditing(false);
                        }}
                        className="flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition"
                      >
                        Cancel
                      </button>
                      <button
                        type="submit"
                        className="flex-1 bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition"
                      >
                        Save Changes
                      </button>
                    </div>
                  </form>
                )}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PlaydateMatcher />);
    </script>
</body>
</html>
